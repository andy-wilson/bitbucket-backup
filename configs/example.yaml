# bb-backup configuration file
# Copy this to bb-backup.yaml and modify as needed

# The Bitbucket workspace (organisation) to backup
workspace: "your-workspace-slug"

# Authentication settings
auth:
  # Authentication method: "api_token", "access_token", "app_password", or "oauth"
  # Note: app_password is deprecated and will stop working June 9, 2026
  method: "api_token"

  # For api_token method (RECOMMENDED):
  # Create an API token at: https://bitbucket.org/account/settings/api-tokens/
  # Required scopes: repository (read), pullrequest (read), issue (read), project (read), account (read)
  # IMPORTANT: API tokens require username for API calls and email for git operations
  username: "${BITBUCKET_USERNAME}"
  email: "${BITBUCKET_EMAIL}"
  api_token: "${BITBUCKET_API_TOKEN}"

  # For access_token method (repository/project/workspace access tokens):
  # Create in repository/project/workspace settings
  # method: "access_token"
  # access_token: "${BITBUCKET_ACCESS_TOKEN}"

  # For app_password method (DEPRECATED - will stop working June 9, 2026):
  # method: "app_password"
  # username: "${BITBUCKET_USERNAME}"
  # app_password: "${BITBUCKET_APP_PASSWORD}"

  # For oauth method (uncomment if using):
  # method: "oauth"
  # client_id: "${BITBUCKET_CLIENT_ID}"
  # client_secret: "${BITBUCKET_CLIENT_SECRET}"

# Storage settings
storage:
  # Storage type: "local" (s3 planned for future)
  type: "local"
  
  # Path to store backups (must exist)
  path: "/backups/bitbucket"

# Rate limiting settings
# Bitbucket Cloud allows ~1000 requests/hour for authenticated requests
rate_limit:
  # Target requests per hour (leave headroom below 1000)
  requests_per_hour: 900
  
  # Maximum burst size for short periods
  burst_size: 10
  
  # Maximum retry attempts on failure
  max_retries: 5
  
  # Initial backoff in seconds when rate limited
  retry_backoff_seconds: 5
  
  # Multiplier for exponential backoff
  retry_backoff_multiplier: 2.0
  
  # Maximum backoff in seconds
  max_backoff_seconds: 300

# Parallelism settings
parallelism:
  # Number of parallel git clone/fetch operations
  git_workers: 4
  
  # Number of parallel API request streams
  api_workers: 2

# Backup content settings
backup:
  # Include pull requests
  include_prs: true
  
  # Include PR comments (requires include_prs)
  include_pr_comments: true
  
  # Include PR activity/approvals (requires include_prs)
  include_pr_activity: true
  
  # Include issues (if issue tracker is enabled on repo)
  include_issues: true
  
  # Include issue comments (requires include_issues)
  include_issue_comments: true
  
  # Exclude repositories matching these glob patterns
  # Example: ["archive-*", "test-*", "deprecated/*"]
  exclude_repos: []
  
  # Only include repositories matching these glob patterns
  # If empty, all repos are included (minus exclusions)
  # Example: ["core-*", "platform-*"]
  include_repos: []

# Logging settings
logging:
  # Log level: "debug", "info", "warn", "error"
  level: "info"
  
  # Log format: "text" or "json"
  format: "text"
  
  # Optional: Log to file instead of stdout
  # file: "/var/log/bb-backup.log"
